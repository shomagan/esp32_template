<html lang="en">   
  <head>
    <title>Operation system control panel</title>
    <meta charset="utf-8">
    <script>
      function get_os_param(){
        var pack = {
          "request":"os_param",
        }
        var json_pack = JSON.stringify(pack);
        console.log("json_pack="+json_pack);
        var request = new XMLHttpRequest();
        request.open('GET', '/get_json.cgi');
        request.setRequestHeader('Json',json_pack);
        request.setRequestHeader('Accept','text/html');
        request.timeout = 5000;
        request.send();

        request.onreadystatechange = function () {
          if (request.readyState == 4 && request.status == 200){
            console.log("server response: "+request.responseText);
            var json_respone = JSON.parse(request.responseText);
            change_form(json_respone);
            document.getElementById("current_os").innerHTML = json_respone.current;
            document.getElementById("main_os").innerHTML = json_respone.main;
            for(var i = 0; i < 4; i++){
            	document.getElementById("os_ver_"+i).innerHTML = json_respone.os_ver[i];
            }
          }
        }
        request.ontimeout = function(){
          console.log("Server is not responding");
          alert("Server is not responding");
        }
      }

      function change_form(os_param){
        if(os_param.current == 1){
          document.getElementById("os1_safe_start").style.display = "none";
          document.getElementById("os1_as_main_start").style.display = "none";
        }else if(os_param.current == 2){
          document.getElementById("os2_safe_start").style.display = "none";
          document.getElementById("os2_as_main_start").style.display = "none";
        }
        if(os_param.current == os_param.main){
          document.getElementById("confirm_os").style.display = "none";
        }else{
          if(os_param.current == 2){
          document.getElementById("os1_safe_start").style.display = "none";
          document.getElementById("os1_as_main_start").style.display = "none";
          }else if(os_param.current == 1){
            document.getElementById("os2_safe_start").style.display = "none";
            document.getElementById("os2_as_main_start").style.display = "none";
          }
        }
      }
    </script>
  </head>    
  <body onload="get_os_param();">  
    <h1>Operation System control panel</h1>  
    OS VER: <a id="os_ver_0"></a>.<a id="os_ver_1"></a>.<a id="os_ver_2"></a>.<a id="os_ver_3"></a>
    <br>
    Current OS:<a id="current_os"></a> /Main OS:<a id="main_os"></a>
    <br>    
    <br>        
    <form action ="/command.cgi" enctype="text/plain" method="get" style="width: 350px">  
      <fieldset>
        <legend>Select action:</legend>
        <select name="os_command">  
          <option value = "change_os" id="change_os">Change OS</option >
          <option value = "confirm_os" id="confirm_os">Set current OS as main</option>
          <option value = "os1_safe_start" id="os1_safe_start">Safe start OS1</option>
          <option value = "os2_safe_start" id="os2_safe_start">Safe start OS2</option>
          <option value = "os1_as_main_start" id="os1_as_main_start">Set main and start OS1</option>
          <option value = "os2_as_main_start" id="os2_as_main_start">Set main and start OS2</option>
        <input type="submit" value="Send command">
      </fieldset>
    </form>  
    <a href="/index.html">Home</a>
  </body>
</html>